<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="根据AcWing平台上SpringBoot框架课的学习编写，本章主要编写项目所需要的前端页面。">
<meta property="og:type" content="article">
<meta property="og:title" content="AcWing SpringBoot项目实战02">
<meta property="og:url" content="http://example.com/2023/03/07/AcWing/SpringBoot/02Course/index.html">
<meta property="og:site_name" content="Atopos&#39;s Blog">
<meta property="og:description" content="根据AcWing平台上SpringBoot框架课的学习编写，本章主要编写项目所需要的前端页面。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20220713210047829.png">
<meta property="og:image" content="https://cdn.acwing.com/media/article/image/2022/07/12/167993_a28e469f01-2a9d61c76c0c44bd5ddb30e4522148c.png">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20220721152928047.png">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20220721153032064.png">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20230309093231779.png">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20230309094217501.png">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20230309101234033.png">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20230309104049555.png">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20230309104101252.png">
<meta property="og:image" content="https://cdn.acwing.com/media/article/image/2022/07/13/167993_2f8b6d2a02-336af4ed02ac84321dea23ad81ba97a.png">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20230309162140554.png">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20230310102526377.png">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20230310110636815.png">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20230310151851129.png">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20220723145947427.png">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20220723164245732.png">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20230310204431685.png">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20230310205139904.png">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20230310210422868.png">
<meta property="og:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20230310213019942.png">
<meta property="article:published_time" content="2023-03-07T10:23:23.000Z">
<meta property="article:modified_time" content="2023-03-31T03:31:45.447Z">
<meta property="article:author" content="Atopos·">
<meta property="article:tag" content="JAVA">
<meta property="article:tag" content="SpringBoot">
<meta property="article:tag" content="AcWing">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/AcWing/SpringBoot/02Course/image-20220713210047829.png">

<link rel="canonical" href="http://example.com/2023/03/07/AcWing/SpringBoot/02Course/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<link rel="stylesheet" href="https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css">
  <title>AcWing SpringBoot项目实战02 | Atopos's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Atopos's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">One step at a time!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">92</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">57</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">15</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/07/AcWing/SpringBoot/02Course/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/./img/head.jpg">
      <meta itemprop="name" content="Atopos·">
      <meta itemprop="description" content="看得懂的书,请仔细看;看不懂的书,请硬着头皮看!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Atopos's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AcWing SpringBoot项目实战02
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-07 18:23:23" itemprop="dateCreated datePublished" datetime="2023-03-07T18:23:23+08:00">2023-03-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-31 11:31:45" itemprop="dateModified" datetime="2023-03-31T11:31:45+08:00">2023-03-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AcWing/" itemprop="url" rel="index"><span itemprop="name">AcWing</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AcWing/Course/" itemprop="url" rel="index"><span itemprop="name">Course</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>30k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>27 分钟</span>
            </span>
            <div class="post-description">根据AcWing平台上SpringBoot框架课的学习编写，本章主要编写项目所需要的前端页面。</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="学习平台"><a href="#学习平台" class="headerlink" title="学习平台"></a>学习平台</h1><p><a target="_blank" rel="noopener" href="https://www.acwing.com/activity/content/introduction/1877/"> AcWing SpringBoot框架课 </a></p>
<h1 id="Vue组件介绍"><a href="#Vue组件介绍" class="headerlink" title="Vue组件介绍"></a>Vue组件介绍</h1><p><strong>组件作用：</strong> 当所有页面都共享一部分内容时，可将该内容写为一个组件。</p>
<p>在 <code>components/</code> 目录下创建。</p>
<p><strong>注意：</strong>组件名称必须有两个字母大写，没有或只有一个会报错</p>
<p><img src="/img/AcWing/SpringBoot/02Course/image-20220713210047829.png" alt="image-20220713210047829"></p>
<ul>
<li>每个<code>.vue</code>文件由三部分组成：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;  /* scoped的作用是在本页面写的css会加上随机字符串，不会影响别的页面 */</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h1 id="页面设计"><a href="#页面设计" class="headerlink" title="页面设计"></a>页面设计</h1><p>效果图：</p>
<p><img src="https://cdn.acwing.com/media/article/image/2022/07/12/167993_a28e469f01-2a9d61c76c0c44bd5ddb30e4522148c.png" alt="2a9d61c76c0c44bd5ddb30e4522148c.png"></p>
<h1 id="添加导航栏"><a href="#添加导航栏" class="headerlink" title="添加导航栏"></a>添加导航栏</h1><h2 id="Bootstrap实现导航栏"><a href="#Bootstrap实现导航栏" class="headerlink" title="Bootstrap实现导航栏"></a>Bootstrap实现导航栏</h2><p>在 <a target="_blank" rel="noopener" href="https://v5.bootcss.com/docs/components/navbar/">Bootstrap</a> 中搜索Navbar就可以找到各种样式的导航栏，选择其中一种即可。</p>
<p>在<code>components/</code>目录下创建<code>NavBar.vue</code>组件，并修改组件中的一些名称信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;nav class=&quot;navbar navbar-expand-lg navbar-light bg-light&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;a class=&quot;navbar-brand&quot; href=&quot;#&quot;&gt;King Of Bots&lt;/a&gt;</span><br><span class="line">    &lt;div class=&quot;collapse navbar-collapse&quot; id=&quot;navbarText&quot;&gt;</span><br><span class="line">      &lt;ul class=&quot;navbar-nav me-auto mb-2 mb-lg-0&quot;&gt;</span><br><span class="line">        &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">          &lt;a class=&quot;nav-link&quot; aria-current=&quot;page&quot; href=&quot;#&quot;&gt;对战&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">          &lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;对局列表&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">          &lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;排行榜&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;ul class=&quot;navbar-nav&quot;&gt;</span><br><span class="line">        &lt;li class=&quot;nav-item dropdown&quot;&gt;</span><br><span class="line">          &lt;a class=&quot;nav-link dropdown-toggle&quot; href=&quot;#&quot; role=&quot;button&quot; data-bs-toggle=&quot;dropdown&quot; aria-expanded=&quot;false&quot;&gt;</span><br><span class="line">            xie zt</span><br><span class="line">          &lt;/a&gt;</span><br><span class="line">          &lt;ul class=&quot;dropdown-menu&quot;&gt;</span><br><span class="line">            &lt;li&gt;&lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;我的Bot&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;hr class=&quot;dropdown-divider&quot;&gt;&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;退出&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">          &lt;/ul&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/nav&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- scoped作用：在这个css样式里面加上一个随机字符串，这样就不会影响其他页面的css了 --&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h2 id="在App-vue中添加组件"><a href="#在App-vue中添加组件" class="headerlink" title="在App.vue中添加组件"></a>在App.vue中添加组件</h2><p>在<code>App.vue</code>中导入该组件</p>
<ul>
<li>首先需要导入该组件<code>import NavBar from &#39;@/components/NavBar.vue&#39;</code></li>
<li>因为使用的是bootstrap，所以需要导入bootstrap的css和js。<code>import &quot;bootstrap/dist/css/boostrap.min.css&quot;</code>、<code>import &quot;bootstrap/dist/js/bootstrap&quot;</code></li>
<li>需要在<code>export default</code> 中声明该组件<code>components: &#123;NavBar&#125;</code></li>
<li>将该组件加入到<code>template</code>中，进行使用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 编写html --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;NavBar/&gt;</span><br><span class="line">  &lt;router-view/&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 编写js --&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import NavBar from &#x27;@/components/NavBar.vue&#x27;</span><br><span class="line">import &quot;bootstrap/dist/css/boostrap.min.css&quot;</span><br><span class="line">import &quot;bootstrap/dist/js/bootstrap&quot;</span><br><span class="line"></span><br><span class="line">export default&#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    NavBar</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!-- 编写css --&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  body&#123;</span><br><span class="line">    background-image: url(&quot;@/assets/background.png&quot;);</span><br><span class="line">    background-size: 100%;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>运行项目后会报错，需要安装一个依赖<code>@popperjs/core</code></p>
<h2 id="会遇到的问题"><a href="#会遇到的问题" class="headerlink" title="会遇到的问题"></a>会遇到的问题</h2><p>在创建好组件后，会提示需要安装依赖<code>@popperjs/core</code>，去vue页面下载安装即可。</p>
<p><img src="/img/AcWing/SpringBoot/02Course/image-20220721152928047.png" alt="image-20220721152928047"></p>
<p><img src="/img/AcWing/SpringBoot/02Course/image-20220721153032064.png" alt="image-20220721153032064"></p>
<h2 id="实现效果"><a href="#实现效果" class="headerlink" title="实现效果"></a>实现效果</h2><p><img src="/img/AcWing/SpringBoot/02Course/image-20230309093231779.png" alt="image-20230309093231779"></p>
<h1 id="页面和导航栏链接地址映射"><a href="#页面和导航栏链接地址映射" class="headerlink" title="页面和导航栏链接地址映射"></a>页面和导航栏链接地址映射</h1><h2 id="创建页面"><a href="#创建页面" class="headerlink" title="创建页面"></a>创建页面</h2><p>在vue中，一般将页面创建在<code>views/</code>目录下。不同的页面分别实现一个对应的<code>.vue</code>文件。这里是将不同的页面分别创建了一个文件夹，然后再自己的文件夹下创建<code>.vue</code>文件。</p>
<p><img src="/img/AcWing/SpringBoot/02Course/image-20230309094217501.png" alt="image-20230309094217501"></p>
<p>以其中一个页面举例：<code>RanklistIndexView.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;排行榜&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h2 id="页面链接映射"><a href="#页面链接映射" class="headerlink" title="页面链接映射"></a>页面链接映射</h2><p>地址映射实现是需要在<code>router/index.js</code>中进行，具体步骤如下：</p>
<ul>
<li>初始的<code>router/index.js</code>代码</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(),</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>导入所有需要映射的页面</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">PkIndexView</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/pk/PkIndexView&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">RanklistIndexView</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/ranklist/RanklistIndexView&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">RecordIndexView</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/record/RecordIndexView&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">UserBotIndexView</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/user/bot/UserBotIndexView&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NotFound</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/error/NotFound&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在<code>const routes</code>中进行页面和地址映射。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&quot;/pk/&quot;</span>,  <span class="comment">// 重定向到对战也面</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/pk/&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;pk_index&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">PkIndexView</span>,  <span class="comment">// 地址栏输入 localhost:8080/pk/ 即可显示 PkIndexView 的内容</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/record/&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;record_index&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">RecordIndexView</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/ranklist/&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;ranklist_index&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">RanklistIndexView</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/404/&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;404&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">NotFound</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/user/bot/&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;user_bot_index&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">UserBotIndexView</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/:catchAll(.*)&quot;</span>,  <span class="comment">// 输入格式错误或乱码，则重定向至404页面</span></span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&quot;/404/&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="实现效果-1"><a href="#实现效果-1" class="headerlink" title="实现效果"></a>实现效果</h2><p><img src="/img/AcWing/SpringBoot/02Course/image-20230309101234033.png" alt="image-20230309101234033"></p>
<h1 id="实现导航栏点击跳转至对应的链接"><a href="#实现导航栏点击跳转至对应的链接" class="headerlink" title="实现导航栏点击跳转至对应的链接"></a>实现导航栏点击跳转至对应的链接</h1><p>实现方法就是将<code>NavBar.vue</code>中对应<code>&lt;a&gt;</code>标签的<code>href</code>属性改为需要跳转的链接即可。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a class=&quot;nav-link&quot; aria-current=&quot;page&quot; href=&quot;/pk/&quot;&gt;对战&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<h2 id="导航栏中存在的问题"><a href="#导航栏中存在的问题" class="headerlink" title="导航栏中存在的问题"></a>导航栏中存在的问题</h2><p><strong>存在问题</strong>：</p>
<ul>
<li>导航栏每次点击页面都会刷新。</li>
<li>导航栏点击某个链接后不会聚焦。显示当前正在此页面中。</li>
</ul>
<p><strong>解决方法</strong>：</p>
<ul>
<li>每次点击某个链接，页面会进行刷新，可以将<code>&lt;a&gt;</code>标签改为<code>&lt;router-link&gt;</code>标签，避免这种问题</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link :class=&quot;route_name == &#x27;pk_index&#x27; ? &#x27;nav-link active&#x27; : &#x27;nav-link&#x27;&quot; :to=&quot;&#123; name: &#x27;pk_index&#x27; &#125;&quot;&gt;</span><br><span class="line">    对战</span><br><span class="line">&lt;/router-link&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>:class</code> 判断是否在当前页面，若在的话则可以添加<code>active</code> 实现该链接名高亮。</li>
<li><code>:to</code> 点击时跳转的页面，通过上面<code>router/index.js</code>页面的映射名字进行跳转。</li>
</ul>
<p>上面会使用到判断当前页面是否某个页面的变量<code>route_name</code>，获取当前在哪个页面的解决方法：</p>
<p>在<code>NavBar.vue</code>中添加如下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; useRoute &#125; from &#x27;vue-router&#x27;</span><br><span class="line">import &#123; computed &#125; from &#x27;vue&#x27;  // 进行实时计算</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;  // 入口</span><br><span class="line">    const route = useRoute();  // 取得当前是哪个页面</span><br><span class="line">    let route_name = computed(() =&gt; route.name)</span><br><span class="line">    return &#123;</span><br><span class="line">      route_name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h1 id="页面美化"><a href="#页面美化" class="headerlink" title="页面美化"></a>页面美化</h1><h2 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h2><ol>
<li>首先每个页面会有一个公共的组件，因此我们需要在<code>components/</code>目录下创建这个公共组件<code>ContentField.vue</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- ContentField.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;card&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;card-body&quot;&gt;</span><br><span class="line">                &lt;slot&gt;</span><br><span class="line">                    &lt;!-- 存放每个页面需要渲染的东西 --&gt;</span><br><span class="line">                &lt;/slot&gt; </span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">	div.container &#123;</span><br><span class="line">        margin-top: 20px;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>2.在每个页面引入这个公共组件，以对战页面<code>PkIndex.vue</code>为例：其中引入组件也分为三部，上面已经说明过了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;ContentField&gt;</span><br><span class="line">        对战</span><br><span class="line">    &lt;/ContentField&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">import ContentField from &#x27;@/components/ContentField.vue&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    components: &#123;</span><br><span class="line">        ContentField</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h2 id="实现效果-2"><a href="#实现效果-2" class="headerlink" title="实现效果"></a>实现效果</h2><p>对战页面</p>
<p><img src="/img/AcWing/SpringBoot/02Course/image-20230309104049555.png" alt="image-20230309104049555"></p>
<p>对局列表页面</p>
<p><img src="/img/AcWing/SpringBoot/02Course/image-20230309104101252.png" alt="image-20230309104101252"></p>
<h1 id="创建对战地图⭐"><a href="#创建对战地图⭐" class="headerlink" title="创建对战地图⭐"></a>创建对战地图⭐</h1><h2 id="地图要求"><a href="#地图要求" class="headerlink" title="地图要求"></a>地图要求</h2><ul>
<li>首先两条蛇初始位置分别在左下角和右上角</li>
<li>地图上分散着若干个障碍物，障碍物需要满足中心对称（为了公平）</li>
<li>同时需要保证两条蛇之间的路径是连通的。</li>
</ul>
<p><img src="https://cdn.acwing.com/media/article/image/2022/07/13/167993_2f8b6d2a02-336af4ed02ac84321dea23ad81ba97a.png" alt="336af4ed02ac84321dea23ad81ba97a.png"></p>
<h2 id="创建游戏基类"><a href="#创建游戏基类" class="headerlink" title="创建游戏基类"></a>创建游戏基类</h2><h3 id="实现目的"><a href="#实现目的" class="headerlink" title="实现目的"></a>实现目的</h3><p>因为游戏中的很多资源需要实现每一帧重新渲染一遍，所以就可以将这部分提取出来，实现一个基类，在基类中实现每帧渲染的操作。后面实现的其他类（例如：蛇、墙、地图）都可以继承该基类，来实现自己的每帧渲染效果。</p>
<p>首先，所有的静态资源都会放置在<code>assets/</code>目录下</p>
<p><img src="/img/AcWing/SpringBoot/02Course/image-20230309162140554.png" alt="image-20230309162140554"></p>
<p>在<code>assets/scripts/</code>下创建一个<strong>基类</strong><code>AcGameObject.js</code>，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">AC_GAME_OBJECTS</span> = [];  <span class="comment">// 用来保存所有创建的对象, 可能包括 蛇、地图、墙</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AcGameObject</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;  <span class="comment">// 构造函数</span></span><br><span class="line">        <span class="variable constant_">AC_GAME_OBJECTS</span>.<span class="title function_">push</span>(<span class="variable language_">this</span>)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">has_called_start</span> = <span class="literal">false</span>;  <span class="comment">// 记录是否执行过start函数</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">timedelta</span> = <span class="number">0</span>; <span class="comment">// 保存两次执行的时间间隔</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;  <span class="comment">// 只执行一次</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;  <span class="comment">// 每一帧执行一次，除了第一帧之外</span></span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">on_destroy</span>(<span class="params"></span>) &#123;  <span class="comment">// 删除之前执行</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">destroy</span>(<span class="params"></span>) &#123;  <span class="comment">// 删除对象</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">on_destroy</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">in</span> <span class="variable constant_">AC_GAME_OBJECTS</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> obj = <span class="variable constant_">AC_GAME_OBJECTS</span>[i];</span><br><span class="line">            <span class="keyword">if</span>(obj === <span class="variable language_">this</span>)&#123;</span><br><span class="line">                <span class="variable constant_">AC_GAME_OBJECTS</span>.<span class="title function_">splice</span>(i);  <span class="comment">// 删除该位置的元素</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> last_timestamp; <span class="comment">// 记录上一次执行的时刻</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">step</span> = timestamp =&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> obj <span class="keyword">of</span> <span class="variable constant_">AC_GAME_OBJECTS</span>) &#123;  <span class="comment">// of 遍历的是值，in遍历的是下标</span></span><br><span class="line">        <span class="keyword">if</span>(!obj.<span class="property">has_called_start</span>)&#123;</span><br><span class="line">            obj.<span class="title function_">start</span>();</span><br><span class="line">            obj.<span class="property">has_called_start</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            obj.<span class="property">timedelta</span> = timestamp - last_timestamp;</span><br><span class="line">            obj.<span class="title function_">update</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    last_timestamp = timestamp; <span class="comment">// 更新上一次执行的时刻</span></span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(step);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">requestAnimationFrame</span>(step);  <span class="comment">// 每帧执行一次调用的函数</span></span><br></pre></td></tr></table></figure>
<h2 id="创建游戏地图类"><a href="#创建游戏地图类" class="headerlink" title="创建游戏地图类"></a>创建游戏地图类</h2><h3 id="实现步骤-1"><a href="#实现步骤-1" class="headerlink" title="实现步骤"></a>实现步骤</h3><ul>
<li>在<code>assets/scripts/</code>目录下创建<code>GameMap.js</code>文件，实现渲染的逻辑</li>
<li>在<code>components/</code>目录下创建<code>GameMap.vue</code> 和 <code>PlayGround.vue</code> 组件，实现游戏地图的页面创建</li>
<li><code>GameMap.vue</code>：主要显示游戏地图，并调用 js 文件进行地图渲染</li>
<li><code>PlayGround.vue</code>主要是显示PK页面的内容，除了游戏地图，后面可能还包含积分板等其他内容。所以在<code>PlayGround</code>组件中需要引入<code>GameMap</code>组件</li>
</ul>
<h3 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h3><p>首先创建<code>PlayGround.vue</code>，用来显示pk页面的内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;playground&quot;&gt;</span><br><span class="line">        &lt;GameMap&gt;</span><br><span class="line">            </span><br><span class="line">        &lt;/GameMap&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import GameMap from &#x27;@/components/GameMap.vue&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    components: &#123;</span><br><span class="line">        GameMap,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    div.playground&#123;</span><br><span class="line">        width: 60vw;</span><br><span class="line">        height: 70vh;</span><br><span class="line">        background: lightblue;</span><br><span class="line">        margin: 40px auto 0;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>实现效果如下：就是背景里蓝色的部分，绿色的部分是后面要绘制的地图，蓝色的部分就是<code>PlayGround</code>主要的效果，它里面除了地图，后期也可以加入比分扳或者聊天框之类的。</p>
<p><img src="/img/AcWing/SpringBoot/02Course/image-20230310102526377.png" alt="image-20230310102526377"></p>
<p>可以看到，在<code>PlayGround.vue</code>中引入了<code>GameMap</code>组件，因此接下来就实现<code>GameMap.vue</code>组件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- GameMap.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div ref=&quot;parent&quot; class=&quot;gamemap&quot;&gt;</span><br><span class="line">        &lt;canvas ref=&quot;canvas&quot;&gt;</span><br><span class="line">            </span><br><span class="line">        &lt;/canvas&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">import &#123; GameMap &#125; from &#x27;@/assets/scripts/GameMap&#x27;;</span><br><span class="line">import &#123; ref, onMounted &#125; from &#x27;vue&#x27;;  // 为了引入canvans</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    setup() &#123;</span><br><span class="line">        let parent = ref(null);</span><br><span class="line">        let canvas = ref(null);</span><br><span class="line"></span><br><span class="line">        onMounted(() =&gt; &#123;</span><br><span class="line">            new GameMap(canvas.value.getContext(&#x27;2d&#x27;), parent.value);  //创建一个GameMap对象</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        return &#123;</span><br><span class="line">            parent,</span><br><span class="line">            canvas</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">div.gamemap &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100%;</span><br><span class="line">    display: flex;  /* 居中，可以使水平和垂直都居中 */</span><br><span class="line">    justify-content: center; /* 设置水平居中 */</span><br><span class="line">    align-items: center;  /* 设置垂直居中 */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>在<code>GameMap.vue</code>组件中，主要是通过调用<code>GameMap.js</code>来进行相应地图的渲染，这里用到了<code>canvas</code>标签。然后将js中渲染的效果在回显至页面中。<br>下面介绍<code>GameMap.js</code>的实现：</p>
<p>首先，<code>GameMap.js</code>需要继承基类<code>AcGameObject.js</code>，实现每帧进行刷新。</p>
<ul>
<li>在js中，首先确定了地图的行数和列数，<code>this.rows</code>和<code>this.cols</code>，因为是正方形，所以都规定为13，这个可以随便改的。</li>
<li>然后通过<code>update_size()</code>函数确定地图中每个单元格的大小<code>this.L</code> 以及地图的宽高（<code>this.width</code> 和 <code>this.height</code>），因为如果页面大小改变的话，需要地图大小一起进行改变，所以需要将该函数在<code>update()</code>函数中调用。</li>
<li>实现地图的渲染<code>render()</code>函数，需要实现明亮交替的块状颜色，所以首先规定两种颜色，然后遍历整个地图，如果行数和列数相加是奇数则是一种颜色，否则是另一种颜色。在对地图渲染时，需要使用到<code>ctx</code>的渲染方法。同时也需要将该函数加入到<code>update()</code>函数中。</li>
</ul>
<p>需要注意的是，<code>ctx</code>从左朝右是横坐标，从上朝下是纵坐标。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AcGameObject</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./AcGameObject&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameMap</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AcGameObject</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">ctx, parent</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(); <span class="comment">// 执行基类的构造函数，就是AcGameObject的构造函数</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span> = ctx;  <span class="comment">// 一个画布</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">parent</span> = parent;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">L</span> = <span class="number">0</span>;  <span class="comment">// 表示地图中每一个小块的宽度</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">rows</span> = <span class="number">13</span>;  <span class="comment">// 地图的行数</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cols</span> = <span class="number">13</span>;  <span class="comment">// 地图的列数</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update_size</span>(<span class="params"></span>) &#123;  <span class="comment">// 更新地图的大小</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">L</span> = <span class="title class_">Math</span>.<span class="title function_">min</span>(<span class="variable language_">this</span>.<span class="property">parent</span>.<span class="property">clientWidth</span> / <span class="variable language_">this</span>.<span class="property">cols</span>, <span class="variable language_">this</span>.<span class="property">parent</span>.<span class="property">clientHeight</span> / <span class="variable language_">this</span>.<span class="property">rows</span>);  <span class="comment">// 计算每个单元格的大小。</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">canvas</span>.<span class="property">width</span> = <span class="variable language_">this</span>.<span class="property">L</span> * <span class="variable language_">this</span>.<span class="property">cols</span>;  <span class="comment">// 单元格的大小乘以列数</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">canvas</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">L</span> * <span class="variable language_">this</span>.<span class="property">rows</span>;  <span class="comment">// 单元格的大小乘以行数</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">update_size</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">render</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 画图 </span></span><br><span class="line">        <span class="keyword">const</span> color_even = <span class="string">&#x27;#AAD751&#x27;</span>, color_odd = <span class="string">&#x27;#A2D149&#x27;</span>  <span class="comment">// 定义两种颜色</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> r = <span class="number">0</span>; r &lt; <span class="variable language_">this</span>.<span class="property">rows</span>; r ++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> c = <span class="number">0</span>; c &lt; <span class="variable language_">this</span>.<span class="property">cols</span>; c ++) &#123;</span><br><span class="line">                <span class="keyword">if</span>((r + c) % <span class="number">2</span> == <span class="number">0</span>) <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">fillStyle</span> = color_even;</span><br><span class="line">                <span class="keyword">else</span> <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">fillStyle</span> = color_odd;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">fillRect</span>(c * <span class="variable language_">this</span>.<span class="property">L</span>, r * <span class="variable language_">this</span>.<span class="property">L</span>, <span class="variable language_">this</span>.<span class="property">L</span>, <span class="variable language_">this</span>.<span class="property">L</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">destroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="创建障碍物类"><a href="#创建障碍物类" class="headerlink" title="创建障碍物类"></a>创建障碍物类</h2><h3 id="实现步骤-2"><a href="#实现步骤-2" class="headerlink" title="实现步骤"></a>实现步骤</h3><ul>
<li>首先障碍物也是需要每帧进行刷新的，所以需要在<code>scripts/</code>目录下创建一个<code>Wall.js</code>继承基类<code>AcGameObject.js</code>，实现地图的绘制功能。</li>
<li>然后在<code>GameMap.js</code>中确定障碍物的位置以及数量，通过调用<code>Wall.js</code>绘制墙。</li>
</ul>
<h3 id="具体实现-1"><a href="#具体实现-1" class="headerlink" title="具体实现"></a>具体实现</h3><h4 id="创建Wall-js类"><a href="#创建Wall-js类" class="headerlink" title="创建Wall.js类"></a>创建<code>Wall.js</code>类</h4><p>需要在构造函数中传入障碍物的左上方顶点坐标，和地图对象，传入坐上方顶点坐标是为了使用<code>ctx.fillRect</code>进行绘制，传入地图对象<code>gamemap</code>是为了使用其中的 <code>ctx</code> 和上面确定的单元格大小<code>this.L</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AcGameObject</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./AcGameObject&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Wall</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AcGameObject</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">r, c, gamemap</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">r</span> = r;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">c</span> = c;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gamemap</span> = gamemap;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = <span class="string">&quot;#B37226&quot;</span>;  <span class="comment">// 颜色</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">render</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> L = <span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="property">L</span>; <span class="comment">// 取出单元格的大小</span></span><br><span class="line">        <span class="keyword">const</span> ctx = <span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="property">ctx</span>;</span><br><span class="line"></span><br><span class="line">        ctx.<span class="property">fillStyle</span> = <span class="variable language_">this</span>.<span class="property">color</span>;</span><br><span class="line">        ctx.<span class="title function_">fillRect</span>(<span class="variable language_">this</span>.<span class="property">c</span> * L, <span class="variable language_">this</span>.<span class="property">r</span> * L, L, L);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="修改GameMap-js"><a href="#修改GameMap-js" class="headerlink" title="修改GameMap.js"></a>修改<code>GameMap.js</code></h4><p><strong>首先先实现给地图的四周添加墙。</strong></p>
<ul>
<li>首先需要在构造函数中添加几个全局变量，<code>this.walls = []</code>用来保存所有生成的<code>Wall</code>对象，<code>this.inner_walls_count</code>用来保存想要在地图中随机生成的障碍物数量。</li>
<li>实现创建障碍物函数<code>create_walls()</code>，然后再<code>start()</code>函数中调用。实现障碍物函数的步骤如下：<ul>
<li>首先定义一个bool类型的数组，用来保存<code>[r][c]</code>位置是否是障碍物，如果是则为<code>true</code>。全部先初始化为<code>false</code></li>
<li>然后使用两个for循环将g数组的上下左右四个边界设为true</li>
<li>最后循环遍历g数组中的每个元素，若为true，则创建一个Wall对象，并存入<code>this.walls</code>中</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">constructor</span>(<span class="params">ctx, parent</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(); <span class="comment">// 执行基类的构造函数，就是AcGameObject的构造函数</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span> = ctx;  <span class="comment">// 一个画布</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">parent</span> = parent;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">L</span> = <span class="number">0</span>;  <span class="comment">// 表示地图中每一个小块的宽度</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rows</span> = <span class="number">13</span>;  <span class="comment">// 地图的行数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cols</span> = <span class="number">13</span>;  <span class="comment">// 地图的列数</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">walls</span> = [];  <span class="comment">// 保存创建的每个障碍物的对象</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">inner_walls_count</span> = <span class="number">40</span>; <span class="comment">// 定义在地图里面障碍物数量</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">create_walls</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> g = [];  <span class="comment">// 布尔数组，如果某个位置是墙，则为true，否则为false</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> r = <span class="number">0</span>; r &lt; <span class="variable language_">this</span>.<span class="property">rows</span>; r ++) &#123;</span><br><span class="line">        g[r] = [];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> c = <span class="number">0</span>; c &lt; <span class="variable language_">this</span>.<span class="property">cols</span>; c ++) &#123;</span><br><span class="line">            g[r][c] = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 给四周加上墙</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> r = <span class="number">0</span>; r &lt; <span class="variable language_">this</span>.<span class="property">rows</span>; r ++) </span><br><span class="line">        g[r][<span class="number">0</span>] = g[r][<span class="variable language_">this</span>.<span class="property">cols</span> - <span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> c = <span class="number">0</span>; c &lt; <span class="variable language_">this</span>.<span class="property">cols</span>; c ++) </span><br><span class="line">        g[<span class="number">0</span>][c] = g[<span class="variable language_">this</span>.<span class="property">rows</span> - <span class="number">1</span>][c] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绘制墙</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> r = <span class="number">0</span>; r &lt; <span class="variable language_">this</span>.<span class="property">rows</span>; r ++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> c = <span class="number">0</span>; c &lt; <span class="variable language_">this</span>.<span class="property">cols</span>; c ++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(g[r][c]) </span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">walls</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Wall</span>(r, c, <span class="variable language_">this</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">create_walls</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现效果如下：</p>
<p><img src="/img/AcWing/SpringBoot/02Course/image-20230310110636815.png" alt="image-20230310110636815"></p>
<p><strong>在地图中随机生成障碍物</strong></p>
<p>实现步骤：</p>
<p>使用随机函数，随机生成两个横纵坐标，然后判断两个横纵坐标对应的位置是否有障碍物，如果有需要重新生成。总共需要生成<code>this.inner_walls_count / 2</code>个随机位置，因为保证对角线对称的话需要同时设置两个位置为true。</p>
<p>需要注意的：</p>
<ul>
<li>在地图中（除四周的墙之外），左上角和右下角不应该生成障碍物，因为是蛇的起点。所以在生成随机障碍物时需要进行判断。</li>
<li>需要保证从左下角到右上角是连通的，使用<code>flood fill</code>算法判断连通性，如果发现不连通，则需要重新生成障碍物。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断两个蛇的起点是否连通， 使用Flodd Fill 算法</span></span><br><span class="line"><span class="title function_">check_connectivity</span>(<span class="params">g, sx, sy, tx, ty</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(sx == tx &amp;&amp; sy == ty) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    g[sx][sy] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> dx = [-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>], dy = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i ++) &#123;</span><br><span class="line">        <span class="keyword">let</span> x = sx + dx[i], y = sy + dy[i];</span><br><span class="line">        <span class="keyword">if</span>(!g[x][y] &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">check_connectivity</span>(g, x, y, tx, ty)) </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">create_walls</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> g = [];  <span class="comment">// 布尔数组，如果某个位置是墙，则为true，否则为false</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> r = <span class="number">0</span>; r &lt; <span class="variable language_">this</span>.<span class="property">rows</span>; r ++) &#123;</span><br><span class="line">        g[r] = [];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> c = <span class="number">0</span>; c &lt; <span class="variable language_">this</span>.<span class="property">cols</span>; c ++) &#123;</span><br><span class="line">            g[r][c] = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 给四周加上墙</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> r = <span class="number">0</span>; r &lt; <span class="variable language_">this</span>.<span class="property">rows</span>; r ++) </span><br><span class="line">        g[r][<span class="number">0</span>] = g[r][<span class="variable language_">this</span>.<span class="property">cols</span> - <span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> c = <span class="number">0</span>; c &lt; <span class="variable language_">this</span>.<span class="property">cols</span>; c ++) </span><br><span class="line">        g[<span class="number">0</span>][c] = g[<span class="variable language_">this</span>.<span class="property">rows</span> - <span class="number">1</span>][c] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建随机障碍物</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">inner_walls_count</span> / <span class="number">2</span>; i ++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">1000</span>; j ++) &#123;  <span class="comment">// 获得随机位置</span></span><br><span class="line">            <span class="keyword">let</span> r = <span class="built_in">parseInt</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="variable language_">this</span>.<span class="property">rows</span>);</span><br><span class="line">            <span class="keyword">let</span> c = <span class="built_in">parseInt</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="variable language_">this</span>.<span class="property">cols</span>);</span><br><span class="line">            <span class="keyword">if</span>(g[r][c] || g[c][r]) <span class="keyword">continue</span>;  <span class="comment">// 该位置已经是障碍物了</span></span><br><span class="line">            <span class="keyword">if</span>(r == <span class="variable language_">this</span>.<span class="property">rows</span> - <span class="number">2</span> &amp;&amp; c == <span class="number">1</span> || r == <span class="number">1</span> &amp;&amp; c == <span class="variable language_">this</span>.<span class="property">cols</span> - <span class="number">2</span>) <span class="comment">// 如果是左下角或者是右上角</span></span><br><span class="line">                <span class="keyword">continue</span>; </span><br><span class="line"></span><br><span class="line">            g[r][c] = g[c][r] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> copy_g = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(g)); <span class="comment">// 将g复制一遍</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="title function_">check_connectivity</span>(copy_g, <span class="variable language_">this</span>.<span class="property">rows</span> - <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="variable language_">this</span>.<span class="property">cols</span> - <span class="number">2</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 不连通</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 绘制墙</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> r = <span class="number">0</span>; r &lt; <span class="variable language_">this</span>.<span class="property">rows</span>; r ++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> c = <span class="number">0</span>; c &lt; <span class="variable language_">this</span>.<span class="property">cols</span>; c ++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(g[r][c]) </span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">walls</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Wall</span>(r, c, <span class="variable language_">this</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= <span class="number">1000</span>; i ++)&#123;  <span class="comment">// 循环一千次，绘制障碍物，直到连通</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">create_walls</span>())</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最终实现效果如下：</p>
<p><img src="/img/AcWing/SpringBoot/02Course/image-20230310151851129.png" alt="image-20230310151851129"></p>
<h1 id="创建菜单和游戏界面⭐"><a href="#创建菜单和游戏界面⭐" class="headerlink" title="创建菜单和游戏界面⭐"></a>创建菜单和游戏界面⭐</h1><h2 id="修改地图"><a href="#修改地图" class="headerlink" title="修改地图"></a>修改地图</h2><p><strong>原因：</strong>上次实现的地图是一个<code>13 * 13</code>的正方形，可能会造成一种情况：在某一时刻后，两个选手的操作会造成两条蛇头走到同一个格子。降低了游戏的公平性。因此需要进行修改。</p>
<p><strong>思想：</strong>我们只需要将两条蛇的坐标 <strong>改为和为奇数</strong> 的情况，也就是说将整张地图改为<code>13 * 14</code>大小。</p>
<p><strong>修改代码：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameMap.js 中</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">rows</span> = <span class="number">13</span>;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">cols</span> = <span class="number">14</span>;</span><br></pre></td></tr></table></figure>
<h3 id="连带修改："><a href="#连带修改：" class="headerlink" title="连带修改："></a>连带修改：</h3><p><strong>原因：</strong>修改地图后会造成游戏地图变成长方形，不能实现主对角线轴对称，所以需要把轴对称改为 <strong>中心对称</strong> 。实现方式如下：</p>
<p>在<code>GameMap.js</code>中修改随机障碍物的生成办法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameMap.js 中</span></span><br><span class="line"><span class="comment">// 创建随机障碍物</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">inner_walls_count</span> / <span class="number">2</span>; i ++) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">1000</span>; j ++) &#123;</span><br><span class="line">        <span class="keyword">let</span> r = <span class="built_in">parseInt</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="variable language_">this</span>.<span class="property">rows</span>);</span><br><span class="line">        <span class="keyword">let</span> c = <span class="built_in">parseInt</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="variable language_">this</span>.<span class="property">cols</span>);</span><br><span class="line">        <span class="keyword">if</span>(g[r][c] || g[<span class="variable language_">this</span>.<span class="property">rows</span> - <span class="number">1</span> - r][<span class="variable language_">this</span>.<span class="property">cols</span> - <span class="number">1</span> - c]) <span class="keyword">continue</span>;  <span class="comment">// 因为地图是长方形，所以需要实现障碍物中心对称</span></span><br><span class="line">        <span class="keyword">if</span>(r == <span class="variable language_">this</span>.<span class="property">rows</span> - <span class="number">2</span> &amp;&amp; c == <span class="number">1</span> || r == <span class="number">1</span> &amp;&amp; c == <span class="variable language_">this</span>.<span class="property">cols</span> - <span class="number">2</span>) <span class="keyword">continue</span>;</span><br><span class="line">        g[r][c] = g[<span class="variable language_">this</span>.<span class="property">rows</span> - <span class="number">1</span> - r][<span class="variable language_">this</span>.<span class="property">cols</span> - <span class="number">1</span> - c] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实现蛇头"><a href="#实现蛇头" class="headerlink" title="实现蛇头"></a>实现蛇头</h2><p><strong>实现思想：</strong>本质上蛇是由一堆联系的格子组成的序列，所以只需要把格子记录下来即可。所以需要实现一个类<code>Cell.js</code>来保存组成蛇的格子信息。</p>
<p>创建<code>Cell.js</code>用于存储蛇所占用的格子信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Cell</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">r, c</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">r</span> = r;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">c</span> = c;</span><br><span class="line">        <span class="comment">// 将横纵坐标替换为canvas的坐标系</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> = c + <span class="number">0.5</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> = r + <span class="number">0.5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="实现Snake-js"><a href="#实现Snake-js" class="headerlink" title="实现Snake.js"></a>实现<code>Snake.js</code></h3><ul>
<li>创建<code>Snake.js</code>对象，进行蛇的绘制渲染。其中会使用数组<code>cells</code>来保存该条蛇所占用的格子信息。<code>cells[0]</code>是蛇头。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AcGameObject</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./AcGameObject&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Cell</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./Cell&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Snake</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AcGameObject</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">info, gamemap</span>) &#123;  <span class="comment">// info 是一个哈希表，存放蛇的各种信息&#123;id,color,r,c&#125;</span></span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">id</span> = info.<span class="property">id</span>;  <span class="comment">// 取出对应蛇的id</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = info.<span class="property">color</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gamemap</span> = gamemap;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cells</span> = [<span class="keyword">new</span> <span class="title class_">Cell</span>(info.<span class="property">r</span>, info.<span class="property">c</span>)]; <span class="comment">// 用来保存组成该条蛇的所有格子，其中cells[0]存放蛇头</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">render</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> L = <span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="property">L</span>;</span><br><span class="line">        <span class="keyword">const</span> ctx = <span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="property">ctx</span>;</span><br><span class="line">        ctx.<span class="property">fillStyle</span> = <span class="variable language_">this</span>.<span class="property">color</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">const</span> cell <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">cells</span>) &#123;  <span class="comment">// 遍历画蛇的所有身体</span></span><br><span class="line">            ctx.<span class="title function_">beginPath</span>(); <span class="comment">// 开启画圆的路径</span></span><br><span class="line">            ctx.<span class="title function_">arc</span>(cell.<span class="property">x</span> * L, cell.<span class="property">y</span> * L, L / <span class="number">2</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>);  <span class="comment">// (圆心横坐标，圆心纵坐标，半径，起始角度，终止角度)</span></span><br><span class="line">            ctx.<span class="title function_">fill</span>(); <span class="comment">// 填充下颜色</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>修改<code>GameMap.js</code>，在<code>GameMap.js</code>中的构造函数创建两条蛇的对象。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameMap.js constructor 中添加</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">Snakes</span> = &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Snake</span>(&#123;id : <span class="number">0</span>, color : <span class="string">&quot;#4876ec&quot;</span>, r : <span class="variable language_">this</span>.<span class="property">rows</span> - <span class="number">2</span>, c : <span class="number">1</span>&#125;, <span class="variable language_">this</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Snake</span>(&#123;id : <span class="number">1</span>, color : <span class="string">&quot;#f94848&quot;</span>, r : <span class="number">1</span>, c : <span class="variable language_">this</span>.<span class="property">cols</span> - <span class="number">2</span>&#125;, <span class="variable language_">this</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>实现效果</strong></p>
<p><img src="/img/AcWing/SpringBoot/02Course/image-20220723145947427.png" alt="image-20220723145947427"></p>
<h2 id="实现蛇的移动"><a href="#实现蛇的移动" class="headerlink" title="实现蛇的移动"></a>实现蛇的移动</h2><p><strong>实现思想：</strong></p>
<p>移动应该是连贯的，但是蛇的身体是由一格一格连续的格子组成的</p>
<blockquote>
<p>中间保持不动，头和尾动，在头部创建一个新的节点，朝着目的地移动。尾巴朝着目的地动</p>
</blockquote>
<p>蛇移动的条件</p>
<blockquote>
<p>同时获取到 两个人 / 两个机器 的操作才能够移动</p>
</blockquote>
<h3 id="最简单的移动"><a href="#最简单的移动" class="headerlink" title="最简单的移动"></a>最简单的移动</h3><p>在<code>Snake.js</code>中添加代码，实现蛇头的向右移动。</p>
<ul>
<li>首先定义一个变量<code>this.speed</code>用来保存 蛇的移动速度，</li>
<li>添加<code>update_move()</code>函数，实现小球的位置变化，在<code>update()</code>函数中调用，实现每帧刷新一次位置。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AcGameObject</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./AcGameObject&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Cell</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./Cell&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Snake</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AcGameObject</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">info, gamemap</span>) &#123;  <span class="comment">// info 是一个哈希表，存放蛇的各种信息&#123;id,color,r,c&#125;</span></span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">id</span> = info.<span class="property">id</span>;  <span class="comment">// 取出对应蛇的id</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = info.<span class="property">color</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gamemap</span> = gamemap;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cells</span> = [<span class="keyword">new</span> <span class="title class_">Cell</span>(info.<span class="property">r</span>, info.<span class="property">c</span>)]; <span class="comment">// 用来保存组成该条蛇的所有格子，其中cells[0]存放蛇头</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">speed</span> = <span class="number">5</span>; <span class="comment">// 蛇每秒钟走5个格子</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">update_move</span>(<span class="params"></span>) &#123;  <span class="comment">// 实现每帧蛇头的位置变化</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">x</span> += <span class="variable language_">this</span>.<span class="property">speed</span> * <span class="variable language_">this</span>.<span class="property">timedelta</span> / <span class="number">1000</span>;  <span class="comment">// this.timedelta在AcGameObject中定义，表示当前帧距离上一帧的时间间隔。</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">update_move</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">render</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所呈现的效果是：两个小球（蛇头）一直向右移动。</p>
<h3 id="实现连贯的移动⭐"><a href="#实现连贯的移动⭐" class="headerlink" title="实现连贯的移动⭐"></a>实现连贯的移动⭐</h3><p><strong>可能存在的问题</strong>：也就是中间某个状态，没有完全移出去，蛇的身子会出现问题。</p>
<p><strong>解决办法</strong>：</p>
<ul>
<li><strong>中间不动，首尾动</strong>！创建的虚拟节点朝着目的地移动。只有两个点动。</li>
<li>考虑蛇什么时候动? 回合制游戏，两个人都有输入的时候，才可以移动。</li>
</ul>
<p>修改<code>Snake.js</code><br>需要在<code>Snake.js</code>的构造函数中加入两个新的变量：</p>
<ul>
<li><code>this.direction</code>：用来保存蛇的移动方向，-1表示没有指令，0，1，2，3分别表示上右下左。初始为-1.</li>
<li><code>this.status</code>：表示蛇的装填，idle表示静止，move表示正在移动，die表示死亡。初始为idle</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AcGameObject</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./AcGameObject&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Cell</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./Cell&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Snake</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AcGameObject</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">info, gamemap</span>) &#123;  <span class="comment">// info 是一个哈希表，存放蛇的各种信息&#123;id,color,r,c&#125;</span></span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">id</span> = info.<span class="property">id</span>;  <span class="comment">// 取出对应蛇的id</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = info.<span class="property">color</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gamemap</span> = gamemap;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cells</span> = [<span class="keyword">new</span> <span class="title class_">Cell</span>(info.<span class="property">r</span>, info.<span class="property">c</span>)]; <span class="comment">// 用来保存组成该条蛇的所有格子，其中cells[0]存放蛇头</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">next_cell</span> = <span class="literal">null</span>;  <span class="comment">// 下一步的目标位置</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">speed</span> = <span class="number">5</span>; <span class="comment">// 蛇每秒钟走5个格子</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">direction</span> = -<span class="number">1</span>;  <span class="comment">// -1 表示没有指令，0,1,2,3 分别表示上右下左</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;idle&quot;</span>; <span class="comment">// idle 表示静止，move 表示正在移动，die表示死亡。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后需要有一个“裁判”来判断两条蛇是否可以进入下一回合，但是参赛者不能当“裁判”，因此需要把判断的代码写在<code>GameMap.js</code>中。代码如下：</p>
<ul>
<li>当某一条蛇的状态还是idle静止的时候，则不能进入下一回合。</li>
<li>当某条蛇的移动方向还没有确认的时候，则不能进入下一回合。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">check_ready</span>(<span class="params"></span>) &#123;  <span class="comment">// 判断两条蛇是否都准备好下一回合</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> snake <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">snakes</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(snake.<span class="property">status</span> !== <span class="string">&quot;idle&quot;</span>) <span class="keyword">return</span> <span class="literal">false</span>;  <span class="comment">// 不是静止，不能进入下一回合</span></span><br><span class="line">        <span class="keyword">if</span>(snake.<span class="property">direction</span> === -<span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;   <span class="comment">// 没有给出下一步的指令，则不能进入下一回合</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在<code>Snake.js</code>中实现一个函数<code>next_step()</code>，作用是将该条蛇的状态改为走下一步，并且记录下一步格子的信息。</p>
<ul>
<li>首先需要定义一个变量<code>this.next_cell</code>来记录蛇下一步走的格子信息，初始为null</li>
<li>需要定义<code>dr</code>和<code>dc</code>来获得蛇头的偏移量。<code>this.step</code>来记录当前正在进行的回合数，因为有的回合需要增加设的长度，有的回合不需要。</li>
<li>实现函数<code>next_step()</code>来讲该条蛇的状态改为走下一步。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AcGameObject</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./AcGameObject&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Cell</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./Cell&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Snake</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AcGameObject</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">info, gamemap</span>) &#123;  <span class="comment">// info 是一个哈希表，存放蛇的各种信息&#123;id,color,r,c&#125;</span></span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">id</span> = info.<span class="property">id</span>;  <span class="comment">// 取出对应蛇的id</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = info.<span class="property">color</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gamemap</span> = gamemap;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cells</span> = [<span class="keyword">new</span> <span class="title class_">Cell</span>(info.<span class="property">r</span>, info.<span class="property">c</span>)]; <span class="comment">// 用来保存组成该条蛇的所有格子，其中cells[0]存放蛇头</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">next_cell</span> = <span class="literal">null</span>;  <span class="comment">// 下一步的目标位置</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">speed</span> = <span class="number">5</span>; <span class="comment">// 蛇每秒钟走5个格子</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">direction</span> = -<span class="number">1</span>;  <span class="comment">// -1 表示没有指令，0,1,2,3 分别表示上右下左</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;idle&quot;</span>; <span class="comment">// idle 表示静止，move 表示正在移动，die表示死亡。</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 蛇头移动方向上的偏移量坐标</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">dr</span> = [-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">dc</span> = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">step</span> = <span class="number">0</span>; <span class="comment">//表示回合数，用来判断蛇是否需要变长</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">next_step</span>(<span class="params"></span>) &#123;  <span class="comment">// 将蛇的状态变为走下一步</span></span><br><span class="line">        <span class="keyword">const</span> d = <span class="variable language_">this</span>.<span class="property">direction</span>;  <span class="comment">// 获得蛇的偏移方向</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">next_cell</span> = <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">r</span> + <span class="variable language_">this</span>.<span class="property">dr</span>[d], <span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">c</span> + <span class="variable language_">this</span>.<span class="property">dc</span>[d]); <span class="comment">// 下一步的格子</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">direction</span> = -<span class="number">1</span>;  <span class="comment">// 清空方向</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;move&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">step</span> ++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>GameMap.js</code>中实现每帧更新蛇的状态。</p>
<ul>
<li>在<code>update()</code>函数中判断两条蛇是否已经准好进入下一回合了（由<code>check_ready()</code>判断）</li>
<li>如果已经准备好了，则调用<code>next_step()</code>函数让两条蛇进入下一回合。这里进行封装。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">check_ready</span>(<span class="params"></span>) &#123; <span class="comment">// 判断两条蛇是否准备下一回合了</span></span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">const</span> snake <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">snakes</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (snake.<span class="property">status</span> !== <span class="string">&quot;idle&quot;</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">if</span> (snake.<span class="property">direction</span> === -<span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">     &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">next_step</span>(<span class="params"></span>) &#123; <span class="comment">// 让两条蛇进入下一回合</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> snake <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">snakes</span>) &#123;</span><br><span class="line">        snake.<span class="title function_">next_step</span>();  <span class="comment">// 调用Snake.js中的next_step函数</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">update_size</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="title function_">check_ready</span>()) &#123; <span class="comment">// 两条蛇都准备好进入下一回合了</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">next_step</span>();  <span class="comment">// 让两条蛇进入下一回合</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">render</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实现读取键盘的操作"><a href="#实现读取键盘的操作" class="headerlink" title="实现读取键盘的操作"></a>实现读取键盘的操作</h2><p>从键盘获取<code>w</code> <code>a</code> <code>s</code> <code>d</code> 和  <code>↑</code> <code>↓</code> <code>←</code> <code>→</code> 来控制两条蛇。</p>
<p>在<code>GameMap.vue</code>中修改，添加<code>tabindex = &quot;0&quot;</code>就可以输入用户操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;canvas ref=&quot;canvas&quot; tabindex=&quot;0&quot;&gt;</span><br><span class="line">            </span><br><span class="line">&lt;/canvas&gt;</span><br></pre></td></tr></table></figure>
<p><strong>绑定事件</strong></p>
<p>在<code>Snake.js</code>中加入一个辅助函数<code>set_direction()</code>，用来设置蛇的移动方向。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Snake.js</span></span><br><span class="line"><span class="comment">//辅助函数</span></span><br><span class="line"><span class="title function_">set_direction</span>(<span class="params">d</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">direction</span> = d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>GameMap.js</code>中修改，添加监听事件<code>add_listening_events()</code>函数，用于监听用户的输入。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameMap.js</span></span><br><span class="line"><span class="title function_">add_listening_events</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">canvas</span>.<span class="title function_">focus</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> [snake0, snake1] = <span class="variable language_">this</span>.<span class="property">snakes</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">canvas</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;keydown&quot;</span>, <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 设置第一条蛇的移动方向</span></span><br><span class="line">        <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;w&#x27;</span>) snake0.<span class="title function_">set_direction</span>(<span class="number">0</span>);  </span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;d&#x27;</span>) snake0.<span class="title function_">set_direction</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;s&#x27;</span>) snake0.<span class="title function_">set_direction</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;a&#x27;</span>) snake0.<span class="title function_">set_direction</span>(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">// 设置第二条蛇的移动方向</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;ArrowUp&#x27;</span>) snake1.<span class="title function_">set_direction</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;ArrowRight&#x27;</span>) snake1.<span class="title function_">set_direction</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;ArrowDown&#x27;</span>) snake1.<span class="title function_">set_direction</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;ArrowLeft&#x27;</span>) snake1.<span class="title function_">set_direction</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>Snake.js</code>中更新状态，让每一帧执行一次更新状态。就是在<code>update()</code>函数中调用<code>add_listening_events()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Snake.js</span></span><br><span class="line"><span class="title function_">update</span>(<span class="params"></span>) &#123; <span class="comment">// 每一帧执行一次</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="string">&#x27;move&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">uppdate_move</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">render</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实现真正的移动"><a href="#实现真正的移动" class="headerlink" title="实现真正的移动"></a>实现真正的移动</h2><h3 id="蛇头移动"><a href="#蛇头移动" class="headerlink" title="蛇头移动"></a>蛇头移动</h3><p>之前在<code>Snake.js</code>的<code>next_step()</code>函数中已经获得了移动的目标位置<code>this.next_cell</code>，同时需要修改<code>next_step()</code>函数，将蛇的每个节点（格子）在数组向后移动一位。</p>
<p>然后需要修改<code>update_move()</code>函数。</p>
<ul>
<li>首先获得当前蛇头和目标位置之间x方向和y方向的偏移量<code>dx</code> 和 <code>dy</code>，然后用勾股定理求出直线偏移量<code>distance</code></li>
<li>如果直线偏移量已经足够小(<code>&lt; 1e-2</code>)则已经到达目标节点，就需要更新蛇头位目标节点。并将目标节点清空。</li>
<li>如果还没有走到目标节点，则需将蛇头位置进行偏移</li>
</ul>
<p>最后，修改<code>update()</code>函数，当检测到该蛇的状态是”move”的时候，才进行移动（调用<code>update_move()</code>函数）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AcGameObject</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./AcGameObject&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Cell</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./Cell&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Snake</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AcGameObject</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">info, gamemap</span>) &#123;  <span class="comment">// info 是一个哈希表，存放蛇的各种信息&#123;id,color,r,c&#125;</span></span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">id</span> = info.<span class="property">id</span>;  <span class="comment">// 取出对应蛇的id</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = info.<span class="property">color</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gamemap</span> = gamemap;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cells</span> = [<span class="keyword">new</span> <span class="title class_">Cell</span>(info.<span class="property">r</span>, info.<span class="property">c</span>)]; <span class="comment">// 用来保存组成该条蛇的所有格子，其中cells[0]存放蛇头</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">next_cell</span> = <span class="literal">null</span>;  <span class="comment">// 下一步的目标位置</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">speed</span> = <span class="number">5</span>; <span class="comment">// 蛇每秒钟走5个格子</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">direction</span> = -<span class="number">1</span>;  <span class="comment">// -1 表示没有指令，0,1,2,3 分别表示上右下左</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;idle&quot;</span>; <span class="comment">// idle 表示静止，move 表示正在移动，die表示死亡。</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 蛇头移动方向上的偏移量坐标</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">dr</span> = [-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">dc</span> = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">step</span> = <span class="number">0</span>; <span class="comment">//表示回合数，用来判断蛇是否需要变长</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">eps</span> = <span class="number">1e-2</span>;  <span class="comment">// 允许的误差，当两个点的坐标相差0.01的时候，则认为两个点走在一起了</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">set_direction</span>(<span class="params">d</span>) &#123;  <span class="comment">// 设置下一步的移动方向</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">direction</span> = d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">next_step</span>(<span class="params"></span>) &#123;  <span class="comment">// 将蛇的状态变为走下一步</span></span><br><span class="line">        <span class="keyword">const</span> d = <span class="variable language_">this</span>.<span class="property">direction</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">next_cell</span> = <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">r</span> + <span class="variable language_">this</span>.<span class="property">dr</span>[d], <span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">c</span> + <span class="variable language_">this</span>.<span class="property">dc</span>[d]); <span class="comment">// 下一步的格子</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">direction</span> = -<span class="number">1</span>;  <span class="comment">// 清空方向</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;move&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">step</span> ++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> k = <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="property">length</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = k; i &gt; <span class="number">0</span>; i --) &#123;  <span class="comment">// 蛇的所有节点(格子)向后移动一位</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cells</span>[i] = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">cells</span>[i - <span class="number">1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update_move</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> dx = <span class="variable language_">this</span>.<span class="property">next_cell</span>.<span class="property">x</span> - <span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">x</span>;</span><br><span class="line">        <span class="keyword">const</span> dy = <span class="variable language_">this</span>.<span class="property">next_cell</span>.<span class="property">y</span> - <span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">y</span>;</span><br><span class="line">        <span class="keyword">const</span> distance = <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(dx * dx + dy * dy);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(distance &lt; <span class="variable language_">this</span>.<span class="property">eps</span>) &#123;  <span class="comment">// 当已经走到目标节点了</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>] = <span class="variable language_">this</span>.<span class="property">next_cell</span>;  <span class="comment">// 更新蛇头位置</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">next_cell</span> = <span class="literal">null</span>;  <span class="comment">// 将目标节点清空</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;idle&quot;</span>; <span class="comment">// 走完了，停下来</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> move_distance = <span class="variable language_">this</span>.<span class="property">speed</span> * <span class="variable language_">this</span>.<span class="property">timedelta</span> /<span class="number">1000</span>; <span class="comment">// 没两帧之间走过的距离</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">x</span> += move_distance * dx / distance;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">y</span> += move_distance * dy / distance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123; <span class="comment">// 每一帧执行一次，每秒钟执行60次</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> === <span class="string">&quot;move&quot;</span>)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">update_move</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">render</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> L = <span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="property">L</span>;</span><br><span class="line">        <span class="keyword">const</span> ctx = <span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="property">ctx</span>;</span><br><span class="line">        ctx.<span class="property">fillStyle</span> = <span class="variable language_">this</span>.<span class="property">color</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">const</span> cell <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">cells</span>) &#123;  <span class="comment">// 遍历画蛇的所有身体</span></span><br><span class="line">            ctx.<span class="title function_">beginPath</span>(); <span class="comment">// 开启画圆的路径</span></span><br><span class="line">            ctx.<span class="title function_">arc</span>(cell.<span class="property">x</span> * L, cell.<span class="property">y</span> * L, L / <span class="number">2</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>);  <span class="comment">// (圆心横坐标，圆心纵坐标，半径，起始角度，终止角度)</span></span><br><span class="line">            ctx.<span class="title function_">fill</span>(); <span class="comment">// 填充下颜色</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="蛇尾移动"><a href="#蛇尾移动" class="headerlink" title="蛇尾移动"></a>蛇尾移动</h3><blockquote>
<p>蛇尾在长度需要增加的回合时，不需要移动；在长度不增加的回合时，是需要移动的。</p>
<p>这里时在前10回合时每回合蛇增加长度1，在大于10回合时，每三回合长度增加1。</p>
</blockquote>
<p>因此首先需要判断在当前回合中，蛇的长度是否需要增加。在<code>Snake.js</code>中添加函数<code>check_tail_increasing()</code>函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Snake.js</span></span><br><span class="line"><span class="title function_">check_tail_increasing</span>(<span class="params"></span>) &#123;  <span class="comment">// 检查当前回合蛇的长度是否需要增加。</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">step</span> &lt; <span class="number">10</span>) <span class="keyword">return</span> <span class="literal">true</span>;  <span class="comment">// 前10步增加长度</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">step</span> % <span class="number">3</span> === <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;  <span class="comment">// 大于10步每三步增加一次长度</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在<code>update_move()</code>中进行修改。</p>
<ul>
<li>当没有走到目标节点的时候，并且蛇尾不增加长度，则蛇尾需要偏移，偏移计算过程和蛇头一样的。</li>
<li>当走到目标节点的时候，并且当前回合不增加长度，则需要将蛇尾节点删除。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">update_move</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> dx = <span class="variable language_">this</span>.<span class="property">next_cell</span>.<span class="property">x</span> - <span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">x</span>;</span><br><span class="line">    <span class="keyword">const</span> dy = <span class="variable language_">this</span>.<span class="property">next_cell</span>.<span class="property">y</span> - <span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">y</span>;</span><br><span class="line">    <span class="keyword">const</span> distance = <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(dx * dx + dy * dy);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(distance &lt; <span class="variable language_">this</span>.<span class="property">eps</span>) &#123;  <span class="comment">// 当已经走到目标节点了</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>] = <span class="variable language_">this</span>.<span class="property">next_cell</span>;  <span class="comment">// 更新蛇头位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">next_cell</span> = <span class="literal">null</span>;  <span class="comment">// 将目标节点清空</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;idle&quot;</span>; <span class="comment">// 走完了，停下来</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">check_tail_increasing</span>()) &#123;  <span class="comment">// 蛇不变长</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">pop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> move_distance = <span class="variable language_">this</span>.<span class="property">speed</span> * <span class="variable language_">this</span>.<span class="property">timedelta</span> /<span class="number">1000</span>; <span class="comment">// 没两帧之间走过的距离</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">x</span> += move_distance * dx / distance;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">y</span> += move_distance * dy / distance;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">check_tail_increasing</span>()) &#123;  <span class="comment">// 不增加长度</span></span><br><span class="line">            <span class="keyword">const</span> k = <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="property">length</span>;</span><br><span class="line">            <span class="keyword">const</span> tail = <span class="variable language_">this</span>.<span class="property">cells</span>[k - <span class="number">1</span>], tail_target = <span class="variable language_">this</span>.<span class="property">cells</span>[k - <span class="number">2</span>];  <span class="comment">// 此时蛇尾的位置，和蛇尾前一个位置。</span></span><br><span class="line">            <span class="keyword">const</span> tail_dx = tail.<span class="property">tail_target</span>.<span class="property">x</span> - tail.<span class="property">x</span>;</span><br><span class="line">            <span class="keyword">const</span> tail_dy = tail_target.<span class="property">y</span> - tail.<span class="property">y</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">x</span> += move_distance * tail_dx / distance;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">y</span> += move_distance * tail_dy / distance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>实现效果</strong></p>
<p><img src="/img/AcWing/SpringBoot/02Course/image-20220723164245732.png" alt="image-20220723164245732"></p>
<h2 id="优化蛇"><a href="#优化蛇" class="headerlink" title="优化蛇"></a>优化蛇</h2><h3 id="蛇身美化"><a href="#蛇身美化" class="headerlink" title="蛇身美化"></a>蛇身美化</h3><blockquote>
<p>为了使蛇美观一点，需要将蛇的身体连贯一点。具体的实现方法是在相邻的两个蛇之间使用一个矩形对其进行覆盖。</p>
</blockquote>
<p>在<code>Snake.js</code>中的<code>render()</code>函数中修改：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Snake.js</span></span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> L = <span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="property">L</span>;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="property">ctx</span>;</span><br><span class="line">    ctx.<span class="property">fillStyle</span> = <span class="variable language_">this</span>.<span class="property">color</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> cell <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">cells</span>) &#123;  <span class="comment">// 遍历画蛇的所有身体</span></span><br><span class="line">        ctx.<span class="title function_">beginPath</span>(); <span class="comment">// 开启画圆的路径</span></span><br><span class="line">        ctx.<span class="title function_">arc</span>(cell.<span class="property">x</span> * L, cell.<span class="property">y</span> * L, L / <span class="number">2</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>);  <span class="comment">// (圆心横坐标，圆心纵坐标，半径，起始角度，终止角度)</span></span><br><span class="line">        ctx.<span class="title function_">fill</span>(); <span class="comment">// 填充下颜色</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="property">length</span>; i ++) &#123;</span><br><span class="line">        <span class="keyword">const</span> a = <span class="variable language_">this</span>.<span class="property">cells</span>[i - <span class="number">1</span>], b = <span class="variable language_">this</span>.<span class="property">cells</span>[i];</span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">x</span> - b.<span class="property">x</span>) &lt; <span class="variable language_">this</span>.<span class="property">eps</span> &amp;&amp; <span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">y</span> - b.<span class="property">y</span>) &lt; <span class="variable language_">this</span>.<span class="property">eps</span>)   <span class="comment">// 当两个节点足够重合，则不用覆盖</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">x</span> - b.<span class="property">x</span>) &lt; <span class="variable language_">this</span>.<span class="property">eps</span>) &#123;</span><br><span class="line">            ctx.<span class="title function_">fillRect</span>((a.<span class="property">x</span> - <span class="number">0.5</span>) * L, <span class="title class_">Math</span>.<span class="title function_">min</span>(a.<span class="property">y</span>, b.<span class="property">y</span>) * L, L, <span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">y</span> - b.<span class="property">y</span>) * L);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ctx.<span class="title function_">fillRect</span>(<span class="title class_">Math</span>.<span class="title function_">min</span>(a.<span class="property">x</span>, b.<span class="property">x</span>) * L, (a.<span class="property">y</span> - <span class="number">0.5</span>) * L, <span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">x</span> - b.<span class="property">x</span>) * L, L);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>实现效果</strong></p>
<p><img src="/img/AcWing/SpringBoot/02Course/image-20230310204431685.png" alt="image-20230310204431685"></p>
<p>可以看到，蛇有点粗，当转弯的时候，会和自己的身体紧贴。因此，需要在<code>render()</code>函数中对蛇的宽度进行修改。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Snake.js</span></span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> L = <span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="property">L</span>;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="property">ctx</span>;</span><br><span class="line">    ctx.<span class="property">fillStyle</span> = <span class="variable language_">this</span>.<span class="property">color</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> cell <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">cells</span>) &#123;  <span class="comment">// 遍历画蛇的所有身体</span></span><br><span class="line">        ctx.<span class="title function_">beginPath</span>(); <span class="comment">// 开启画圆的路径</span></span><br><span class="line">        ctx.<span class="title function_">arc</span>(cell.<span class="property">x</span> * L, cell.<span class="property">y</span> * L, L / <span class="number">2</span> * <span class="number">0.8</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>);  <span class="comment">// (圆心横坐标，圆心纵坐标，半径，起始角度，终止角度)</span></span><br><span class="line">        ctx.<span class="title function_">fill</span>(); <span class="comment">// 填充下颜色</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="property">length</span>; i ++) &#123;</span><br><span class="line">        <span class="keyword">const</span> a = <span class="variable language_">this</span>.<span class="property">cells</span>[i - <span class="number">1</span>], b = <span class="variable language_">this</span>.<span class="property">cells</span>[i];</span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">x</span> - b.<span class="property">x</span>) &lt; <span class="variable language_">this</span>.<span class="property">eps</span> &amp;&amp; <span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">y</span> - b.<span class="property">y</span>) &lt; <span class="variable language_">this</span>.<span class="property">eps</span>) </span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">x</span> - b.<span class="property">x</span>) &lt; <span class="variable language_">this</span>.<span class="property">eps</span>) &#123;</span><br><span class="line">            ctx.<span class="title function_">fillRect</span>((a.<span class="property">x</span> - <span class="number">0.4</span>) * L, <span class="title class_">Math</span>.<span class="title function_">min</span>(a.<span class="property">y</span>, b.<span class="property">y</span>) * L, L * <span class="number">0.8</span>, <span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">y</span> - b.<span class="property">y</span>) * L);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ctx.<span class="title function_">fillRect</span>(<span class="title class_">Math</span>.<span class="title function_">min</span>(a.<span class="property">x</span>, b.<span class="property">x</span>) * L, (a.<span class="property">y</span> - <span class="number">0.4</span>) * L, <span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">x</span> - b.<span class="property">x</span>) * L, L * <span class="number">0.8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>实现效果</strong></p>
<p><img src="/img/AcWing/SpringBoot/02Course/image-20230310205139904.png" alt="image-20230310205139904"></p>
<h3 id="撞墙判定"><a href="#撞墙判定" class="headerlink" title="撞墙判定"></a>撞墙判定</h3><ul>
<li>首先撞墙判定属于“裁判”的工作，所以需要写在<code>GameMap.js</code>中，实现<code>check_valid(cell)</code>函数，判定下一位置是否合法：<ul>
<li>当下一位置是障碍物，则不合法</li>
<li>当下一位置是蛇的身体，如果是尾巴，需要判断尾巴是否会前进（调用<code>check_tail_increasing()</code>函数），如果会前进，则合法，否则遍历两个蛇的身体，如果是任何一处，都不合法。</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameMap.js</span></span><br><span class="line"><span class="title function_">check_valid</span>(<span class="params">cell</span>) &#123;  <span class="comment">// 检测目标位置是否合法： 没有撞到两条蛇的身体，或者障碍物</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> wall <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">walls</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(wall.<span class="property">r</span> === cell.<span class="property">r</span> &amp;&amp; wall.<span class="property">c</span> === cell.<span class="property">c</span>) <span class="keyword">return</span> <span class="literal">false</span>;  <span class="comment">// 如果下一位置是障碍物</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> snake <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">snakes</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> k = snake.<span class="property">cells</span>.<span class="property">length</span>;</span><br><span class="line">        <span class="keyword">if</span>(!snake.<span class="title function_">check_tail_increasing</span>()) &#123;  <span class="comment">// 当蛇尾会前进的时候</span></span><br><span class="line">            k --;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; k; i ++) &#123;  <span class="comment">// 遍历蛇的每个节点，判断是否会装上。</span></span><br><span class="line">            <span class="keyword">if</span>(snake.<span class="property">cells</span>[i].<span class="property">r</span> === cell.<span class="property">r</span> &amp;&amp; snake.<span class="property">cells</span>[i].<span class="property">c</span> === cell.<span class="property">c</span>) </span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>Snake.js</code>的<code>next_step()</code>函数中判断下一位置是否合法，如果不合法，需要将蛇的状态修改为die.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Snake.js</span></span><br><span class="line"><span class="title function_">next_step</span>(<span class="params"></span>) &#123;  <span class="comment">// 将蛇的状态变为走下一步</span></span><br><span class="line">    <span class="keyword">const</span> d = <span class="variable language_">this</span>.<span class="property">direction</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">next_cell</span> = <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">r</span> + <span class="variable language_">this</span>.<span class="property">dr</span>[d], <span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">c</span> + <span class="variable language_">this</span>.<span class="property">dc</span>[d]); <span class="comment">// 下一步的格子</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">direction</span> = -<span class="number">1</span>;  <span class="comment">// 清空方向</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;move&quot;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">step</span> ++;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> k = <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = k; i &gt; <span class="number">0</span>; i --) &#123;  <span class="comment">// 蛇的所有节点(格子)向后移动一位</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cells</span>[i] = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">cells</span>[i - <span class="number">1</span>]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="title function_">check_valid</span>(<span class="variable language_">this</span>.<span class="property">next_cell</span>)) &#123;  <span class="comment">// 如果下一位置不合法</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;die&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时需要在<code>render()</code>函数中进行修改，如果判断到该条蛇的状态时die时，将蛇的颜色渲染为白色。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Snake.js</span></span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> L = <span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="property">L</span>;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="property">ctx</span>;</span><br><span class="line">    ctx.<span class="property">fillStyle</span> = <span class="variable language_">this</span>.<span class="property">color</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> === <span class="string">&quot;die&quot;</span>)  <span class="comment">// 新增</span></span><br><span class="line">        ctx.<span class="property">fillStyle</span> = <span class="string">&quot;white&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> cell <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">cells</span>) &#123;  <span class="comment">// 遍历画蛇的所有身体</span></span><br><span class="line">        ctx.<span class="title function_">beginPath</span>(); <span class="comment">// 开启画圆的路径</span></span><br><span class="line">        ctx.<span class="title function_">arc</span>(cell.<span class="property">x</span> * L, cell.<span class="property">y</span> * L, L / <span class="number">2</span> * <span class="number">0.8</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>);  <span class="comment">// (圆心横坐标，圆心纵坐标，半径，起始角度，终止角度)</span></span><br><span class="line">        ctx.<span class="title function_">fill</span>(); <span class="comment">// 填充下颜色</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="property">length</span>; i ++) &#123;</span><br><span class="line">        <span class="keyword">const</span> a = <span class="variable language_">this</span>.<span class="property">cells</span>[i - <span class="number">1</span>], b = <span class="variable language_">this</span>.<span class="property">cells</span>[i];</span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">x</span> - b.<span class="property">x</span>) &lt; <span class="variable language_">this</span>.<span class="property">eps</span> &amp;&amp; <span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">y</span> - b.<span class="property">y</span>) &lt; <span class="variable language_">this</span>.<span class="property">eps</span>) </span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">x</span> - b.<span class="property">x</span>) &lt; <span class="variable language_">this</span>.<span class="property">eps</span>) &#123;</span><br><span class="line">            ctx.<span class="title function_">fillRect</span>((a.<span class="property">x</span> - <span class="number">0.4</span>) * L, <span class="title class_">Math</span>.<span class="title function_">min</span>(a.<span class="property">y</span>, b.<span class="property">y</span>) * L, L * <span class="number">0.8</span>, <span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">y</span> - b.<span class="property">y</span>) * L);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ctx.<span class="title function_">fillRect</span>(<span class="title class_">Math</span>.<span class="title function_">min</span>(a.<span class="property">x</span>, b.<span class="property">x</span>) * L, (a.<span class="property">y</span> - <span class="number">0.4</span>) * L, <span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">x</span> - b.<span class="property">x</span>) * L, L * <span class="number">0.8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现后效果，当判定失败后，不能进行任何操作，因为此时状态为die。</p>
<p><img src="/img/AcWing/SpringBoot/02Course/image-20230310210422868.png" alt="image-20230310210422868"></p>
<h3 id="实现眼睛"><a href="#实现眼睛" class="headerlink" title="实现眼睛"></a>实现眼睛</h3><p>需要注意的是，蛇上一刻移动的方向决定了眼睛的位置。因此需要在<code>Snake.js</code>中的构造函数中定义几个变量：</p>
<ul>
<li><code>this.eye_direction</code> 保存蛇眼睛的方向。起始就是下一步移动的方向。需要在<code>next_step()</code>函数中进行更新，两条蛇的初始方向不同。</li>
<li><code>this.eye_dx</code>和<code>this.eye_dy</code> 蛇眼睛不同方向的偏移量</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Snake.js</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">eye_direction</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">id</span> === <span class="number">1</span>) <span class="variable language_">this</span>.<span class="property">eye_direction</span> = <span class="number">2</span>; <span class="comment">// 左下角蛇初始朝上，右上角的蛇朝下</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">eye_dx</span> = [  <span class="comment">// 蛇眼睛不同方向的x的偏移量(两个眼睛)</span></span><br><span class="line">    [-<span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, -<span class="number">1</span>],</span><br><span class="line">    [-<span class="number">1</span>, -<span class="number">1</span>],</span><br><span class="line">];</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">eye_dy</span> = [  <span class="comment">// 蛇眼睛不同方向的y的偏移量</span></span><br><span class="line">    [-<span class="number">1</span>, -<span class="number">1</span>],</span><br><span class="line">    [-<span class="number">1</span>, <span class="number">1</span>,],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, -<span class="number">1</span>],</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="title function_">next_step</span>(<span class="params"></span>) &#123;  <span class="comment">// 将蛇的状态变为走下一步</span></span><br><span class="line">        <span class="keyword">const</span> d = <span class="variable language_">this</span>.<span class="property">direction</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">next_cell</span> = <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">r</span> + <span class="variable language_">this</span>.<span class="property">dr</span>[d], <span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">c</span> + <span class="variable language_">this</span>.<span class="property">dc</span>[d]); <span class="comment">// 下一步的格子</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">direction</span> = -<span class="number">1</span>;  <span class="comment">// 清空方向</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;move&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">step</span> ++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> k = <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="property">length</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = k; i &gt; <span class="number">0</span>; i --) &#123;  <span class="comment">// 蛇的所有节点(格子)向后移动一位</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cells</span>[i] = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">cells</span>[i - <span class="number">1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="title function_">check_valid</span>(<span class="variable language_">this</span>.<span class="property">next_cell</span>)) &#123;  <span class="comment">// 如果下一位置不合法</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;die&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">eye_direction</span> = d; <span class="comment">// 更新蛇眼的方向。</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>在<code>render()</code>函数中实现眼睛的渲染</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> L = <span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="property">L</span>;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="property">ctx</span>;</span><br><span class="line">    ctx.<span class="property">fillStyle</span> = <span class="variable language_">this</span>.<span class="property">color</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> === <span class="string">&quot;die&quot;</span>) </span><br><span class="line">        ctx.<span class="property">fillStyle</span> = <span class="string">&quot;white&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> cell <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">cells</span>) &#123;  <span class="comment">// 遍历画蛇的所有身体</span></span><br><span class="line">        ctx.<span class="title function_">beginPath</span>(); <span class="comment">// 开启画圆的路径</span></span><br><span class="line">        ctx.<span class="title function_">arc</span>(cell.<span class="property">x</span> * L, cell.<span class="property">y</span> * L, L / <span class="number">2</span> * <span class="number">0.8</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>);  <span class="comment">// (圆心横坐标，圆心纵坐标，半径，起始角度，终止角度)</span></span><br><span class="line">        ctx.<span class="title function_">fill</span>(); <span class="comment">// 填充下颜色</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="property">length</span>; i ++) &#123;</span><br><span class="line">        <span class="keyword">const</span> a = <span class="variable language_">this</span>.<span class="property">cells</span>[i - <span class="number">1</span>], b = <span class="variable language_">this</span>.<span class="property">cells</span>[i];</span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">x</span> - b.<span class="property">x</span>) &lt; <span class="variable language_">this</span>.<span class="property">eps</span> &amp;&amp; <span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">y</span> - b.<span class="property">y</span>) &lt; <span class="variable language_">this</span>.<span class="property">eps</span>) </span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">x</span> - b.<span class="property">x</span>) &lt; <span class="variable language_">this</span>.<span class="property">eps</span>) &#123;</span><br><span class="line">            ctx.<span class="title function_">fillRect</span>((a.<span class="property">x</span> - <span class="number">0.4</span>) * L, <span class="title class_">Math</span>.<span class="title function_">min</span>(a.<span class="property">y</span>, b.<span class="property">y</span>) * L, L * <span class="number">0.8</span>, <span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">y</span> - b.<span class="property">y</span>) * L);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ctx.<span class="title function_">fillRect</span>(<span class="title class_">Math</span>.<span class="title function_">min</span>(a.<span class="property">x</span>, b.<span class="property">x</span>) * L, (a.<span class="property">y</span> - <span class="number">0.4</span>) * L, <span class="title class_">Math</span>.<span class="title function_">abs</span>(a.<span class="property">x</span> - b.<span class="property">x</span>) * L, L * <span class="number">0.8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绘制眼睛</span></span><br><span class="line">    ctx.<span class="property">fillStyle</span> = <span class="string">&quot;black&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i ++) &#123;</span><br><span class="line">        <span class="keyword">const</span> eye_x = (<span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">x</span> + <span class="variable language_">this</span>.<span class="property">eye_dx</span>[<span class="variable language_">this</span>.<span class="property">eye_direction</span>][i] * <span class="number">0.15</span>) * L;</span><br><span class="line">        <span class="keyword">const</span> eye_y = (<span class="variable language_">this</span>.<span class="property">cells</span>[<span class="number">0</span>].<span class="property">y</span> + <span class="variable language_">this</span>.<span class="property">eye_dy</span>[<span class="variable language_">this</span>.<span class="property">eye_direction</span>][i] * <span class="number">0.15</span>) * L;</span><br><span class="line">        ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">        ctx.<span class="title function_">arc</span>(eye_x, eye_y, L * <span class="number">0.05</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>);</span><br><span class="line">        ctx.<span class="title function_">fill</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>实现效果</strong></p>
<p><img src="/img/AcWing/SpringBoot/02Course/image-20230310213019942.png" alt="image-20230310213019942"></p>

    </div>

    
    
    <div class="post-widgets">
    <div
      class="social-share"
      
        data-sites="weibo,qq,wechat,tencent,douban,qzone,linkedin,diandian,facebook,twitter,google"
      
      
        data-wechat-qrcode-title="share.title"
      
      
        data-wechat-qrcode-helper="share.prompt"
      
    >
    </div>
  </div>
  <script src="https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js"></script><script src="//sdk.jinrishici.com/v2/browser/jinrishici.js"></script>
<script>
  jinrishici.load((result) => {
    let jrsc = document.getElementById('jrsc');
    const data = result.data;
    let author = data.origin.author;
    let title = '《' + data.origin.title + '》';
    let content = data.content.substr(0, data.content.length - 1);
    let dynasty = data.origin.dynasty.substr(0, data.origin.dynasty.length - 1);
    jrsc.innerText = content + ' @ ' + dynasty + '·' + author + title;
  });
</script>
<div style="text-align: center"><span id="jrsc" >正在加载今日诗词....</span></div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Atopos·
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://example.com/2023/03/07/AcWing/SpringBoot/02Course/" title="AcWing SpringBoot项目实战02">http://example.com/2023/03/07/AcWing/SpringBoot/02Course/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/JAVA/" rel="tag"># JAVA</a>
              <a href="/tags/SpringBoot/" rel="tag"># SpringBoot</a>
              <a href="/tags/AcWing/" rel="tag"># AcWing</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/03/07/AcWing/SpringBoot/01Course/" rel="prev" title="AcWing SpringBoot项目实战01">
      <i class="fa fa-chevron-left"></i> AcWing SpringBoot项目实战01
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/03/09/AcWing/SpringBoot/03Course/" rel="next" title="AcWing SpringBoot项目实战03">
      AcWing SpringBoot项目实战03 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0"><span class="nav-number">1.</span> <span class="nav-text">学习平台</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Vue%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.</span> <span class="nav-text">Vue组件介绍</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.</span> <span class="nav-text">页面设计</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%AF%BC%E8%88%AA%E6%A0%8F"><span class="nav-number">4.</span> <span class="nav-text">添加导航栏</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Bootstrap%E5%AE%9E%E7%8E%B0%E5%AF%BC%E8%88%AA%E6%A0%8F"><span class="nav-number">4.1.</span> <span class="nav-text">Bootstrap实现导航栏</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8App-vue%E4%B8%AD%E6%B7%BB%E5%8A%A0%E7%BB%84%E4%BB%B6"><span class="nav-number">4.2.</span> <span class="nav-text">在App.vue中添加组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%9A%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">4.3.</span> <span class="nav-text">会遇到的问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C"><span class="nav-number">4.4.</span> <span class="nav-text">实现效果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E5%92%8C%E5%AF%BC%E8%88%AA%E6%A0%8F%E9%93%BE%E6%8E%A5%E5%9C%B0%E5%9D%80%E6%98%A0%E5%B0%84"><span class="nav-number">5.</span> <span class="nav-text">页面和导航栏链接地址映射</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B5%E9%9D%A2"><span class="nav-number">5.1.</span> <span class="nav-text">创建页面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E9%93%BE%E6%8E%A5%E6%98%A0%E5%B0%84"><span class="nav-number">5.2.</span> <span class="nav-text">页面链接映射</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C-1"><span class="nav-number">5.3.</span> <span class="nav-text">实现效果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%AF%BC%E8%88%AA%E6%A0%8F%E7%82%B9%E5%87%BB%E8%B7%B3%E8%BD%AC%E8%87%B3%E5%AF%B9%E5%BA%94%E7%9A%84%E9%93%BE%E6%8E%A5"><span class="nav-number">6.</span> <span class="nav-text">实现导航栏点击跳转至对应的链接</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%BC%E8%88%AA%E6%A0%8F%E4%B8%AD%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">6.1.</span> <span class="nav-text">导航栏中存在的问题</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E7%BE%8E%E5%8C%96"><span class="nav-number">7.</span> <span class="nav-text">页面美化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="nav-number">7.1.</span> <span class="nav-text">实现步骤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C-2"><span class="nav-number">7.2.</span> <span class="nav-text">实现效果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%AF%B9%E6%88%98%E5%9C%B0%E5%9B%BE%E2%AD%90"><span class="nav-number">8.</span> <span class="nav-text">创建对战地图⭐</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%B0%E5%9B%BE%E8%A6%81%E6%B1%82"><span class="nav-number">8.1.</span> <span class="nav-text">地图要求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%B8%B8%E6%88%8F%E5%9F%BA%E7%B1%BB"><span class="nav-number">8.2.</span> <span class="nav-text">创建游戏基类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E7%9B%AE%E7%9A%84"><span class="nav-number">8.2.1.</span> <span class="nav-text">实现目的</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%B8%B8%E6%88%8F%E5%9C%B0%E5%9B%BE%E7%B1%BB"><span class="nav-number">8.3.</span> <span class="nav-text">创建游戏地图类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4-1"><span class="nav-number">8.3.1.</span> <span class="nav-text">实现步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="nav-number">8.3.2.</span> <span class="nav-text">具体实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%9A%9C%E7%A2%8D%E7%89%A9%E7%B1%BB"><span class="nav-number">8.4.</span> <span class="nav-text">创建障碍物类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4-2"><span class="nav-number">8.4.1.</span> <span class="nav-text">实现步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-1"><span class="nav-number">8.4.2.</span> <span class="nav-text">具体实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAWall-js%E7%B1%BB"><span class="nav-number">8.4.2.1.</span> <span class="nav-text">创建Wall.js类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9GameMap-js"><span class="nav-number">8.4.2.2.</span> <span class="nav-text">修改GameMap.js</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%8F%9C%E5%8D%95%E5%92%8C%E6%B8%B8%E6%88%8F%E7%95%8C%E9%9D%A2%E2%AD%90"><span class="nav-number">9.</span> <span class="nav-text">创建菜单和游戏界面⭐</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%9C%B0%E5%9B%BE"><span class="nav-number">9.1.</span> <span class="nav-text">修改地图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E5%B8%A6%E4%BF%AE%E6%94%B9%EF%BC%9A"><span class="nav-number">9.1.1.</span> <span class="nav-text">连带修改：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E8%9B%87%E5%A4%B4"><span class="nav-number">9.2.</span> <span class="nav-text">实现蛇头</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0Snake-js"><span class="nav-number">9.2.1.</span> <span class="nav-text">实现Snake.js</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E8%9B%87%E7%9A%84%E7%A7%BB%E5%8A%A8"><span class="nav-number">9.3.</span> <span class="nav-text">实现蛇的移动</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E7%A7%BB%E5%8A%A8"><span class="nav-number">9.3.1.</span> <span class="nav-text">最简单的移动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E8%BF%9E%E8%B4%AF%E7%9A%84%E7%A7%BB%E5%8A%A8%E2%AD%90"><span class="nav-number">9.3.2.</span> <span class="nav-text">实现连贯的移动⭐</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E8%AF%BB%E5%8F%96%E9%94%AE%E7%9B%98%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="nav-number">9.4.</span> <span class="nav-text">实现读取键盘的操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E7%9C%9F%E6%AD%A3%E7%9A%84%E7%A7%BB%E5%8A%A8"><span class="nav-number">9.5.</span> <span class="nav-text">实现真正的移动</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%9B%87%E5%A4%B4%E7%A7%BB%E5%8A%A8"><span class="nav-number">9.5.1.</span> <span class="nav-text">蛇头移动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%9B%87%E5%B0%BE%E7%A7%BB%E5%8A%A8"><span class="nav-number">9.5.2.</span> <span class="nav-text">蛇尾移动</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E8%9B%87"><span class="nav-number">9.6.</span> <span class="nav-text">优化蛇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%9B%87%E8%BA%AB%E7%BE%8E%E5%8C%96"><span class="nav-number">9.6.1.</span> <span class="nav-text">蛇身美化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%92%9E%E5%A2%99%E5%88%A4%E5%AE%9A"><span class="nav-number">9.6.2.</span> <span class="nav-text">撞墙判定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E7%9C%BC%E7%9D%9B"><span class="nav-number">9.6.3.</span> <span class="nav-text">实现眼睛</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Atopos·"
      src="/./img/head.jpg">
  <p class="site-author-name" itemprop="name">Atopos·</p>
  <div class="site-description" itemprop="description">看得懂的书,请仔细看;看不懂的书,请硬着头皮看!</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">92</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">57</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/aaaatopos" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;aaaatopos" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/xzt2520@163.com" title="E-Mail → xzt2520@163.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Atopos·</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">1m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">15:16</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://lib.baomitu.com/canvas-nest.js/1.0.1/canvas-nest.js"></script>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
